add nested commands (use stack or recursive approach)

add check for union compatibility

modularise the code in seperate files, 
